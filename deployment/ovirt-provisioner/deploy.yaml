---
- hosts: k8s-ovirt-masters
  remote_user: root
  vars:
    # defaults - override in an inventory file or include
    engine_url: https://hostname/ovirt-engine/api
    engine_username: admin@internal
    engine_password: pass
    engine_insecure: false
    engine_ca_file:
    manifest_file: ovirt-provisioner-manifest.yaml
    deprovision: false
    provisioner_version: v0.2.0
  tags: tagged
  tasks:
    - name: Copy the all-in-one manifest
      template:
        src: "{{ manifest_file }}.j2"
        dest: /root/{{ manifest_file }}
        force: yes

    - name: Provision the provisioner and its companion object
      command: kubectl create -f /root/{{ manifest_file }}
      when: not deprovision

    - name: De-Provision the provisioner and its companion object
      command: kubectl delete -f /root/{{ manifest_file }}
      when: deprovision
