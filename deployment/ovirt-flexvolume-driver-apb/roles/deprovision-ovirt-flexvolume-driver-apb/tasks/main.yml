##############################################################################
## Deprovision ovirt-flexvolume-driver
## This role executes much of the needed functionality to deprovision an
## application using an Ansible Playbook Bundle and delete resources created
## in the sample apb generated by the provision role.
##############################################################################

- name: login
  command: "oc login -u {{ admin_user }} -p {{ admin_password }}"

##############################################################################
## Deprovision a route
##############################################################################
- openshift_v1_route:
    name: ovirt-flexvolume-driver
    namespace: '{{ namespace }}'
    state: absent


##############################################################################
## Deprovision a service
##############################################################################
- k8s_v1_service:
    name: ovirt-flexvolume-driver
    namespace: '{{ namespace }}'
    state: absent


##############################################################################
## Deprovision a deployment config
## When removing a Deployment Config, OpenShift will automatically clean up
## its associated resources like replication controllers and pods
##############################################################################
- openshift_v1_deployment_config:
    name: ovirt-flexvolume-driver
    namespace: '{{ namespace }}'
    state: absent


##############################################################################
## Deprovision the flex daemonset
##############################################################################
- openshift_v1_daemon_set:
    name: ovirt-flexvolume-driver
    namespace: "{{ namespace }}"
    state: absent

##############################################################################
## Deprovision the provisioner deployment
##############################################################################
- k8s_apps_v1beta1_deployment:
    name: ovirt-volume-provisioner
    namespace: "{{ namespace }}"
    state: absent
